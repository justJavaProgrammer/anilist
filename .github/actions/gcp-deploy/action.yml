name: gcp-deploy
description: Push the docker image to GCP AR

runs:
  using: "composite"
  steps:
    - name: Docker Auth
      id: docker-auth
      uses: 'docker/login-action@v1'
      with:
        username: 'oauth2accesstoken'
        password: '${{ steps.auth.outputs.access_token }}'
        registry: '${{ env.AR_REPO_LOCATION }}-docker.pkg.dev'
    - name: Build and Push Container
      run: |-
        docker build -t "${{ env.AR_URL }}/${{ env.IMAGE_NAME }}:${{ github.sha }}" ./
        docker push "${{ env.AR_URL }}/${{ env.IMAGE_NAME }}:${{ github.sha }}"
      shell: bash